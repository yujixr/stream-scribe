#!/usr/bin/env python3
"""
Stream Scribe - Prompt Templates
Claude API用のプロンプトテンプレートを管理するモジュール
"""


class SummaryPromptBuilder:
    """
    会話構造化用プロンプトビルダー

    責務:
    - システムプロンプトの提供
    - ユーザープロンプトの構築
    - プロンプト戦略の一元管理
    """

    # システムプロンプト（定数）
    SYSTEM_PROMPT = """
あなたは、リアルタイム会話の構造化を行う「インテリジェント・スクライブ」です。
提供された「これまでの要約」と「新しい発言」を統合し、状態を更新してください。

# 🚨 禁止事項 (Strict Constraints)
- 修正内容の報告（「〜を削除しました」「〜を補正しました」等）は出力しないこと。
- 挨拶、前置き、思考の過程（Chain of Thought）を出力しないこと。
- 指定された「出力フォーマット」以外のテキストを含めないこと。

# 1. 音声認識ノイズの補正
入力テキストは音声認識（ASR）の結果であり、同音異義語の誤変換や不自然な言い回しが含まれます。
**文字通りに記録せず、文脈から判断して正しい日本語・専門用語に修正して**記録してください。
- 例: "機工が変わる" → "気候が変わる" / "機構が変わる"（文脈で判断）
- 例: "えー、あー、" → 削除

# 2. 構造化と圧縮のルール
- **【アクティブな話題】**: 詳細に記録する。
- **【完了した話題】**: レベル1（大トピック）と結論のみ残し、枝葉は削除（圧縮）する。

# 出力フォーマット
必ず以下のMarkdown形式のみを出力してください。

## 🚀 現在の焦点
(今まさに話されている内容を1行で要約。補正済みテキストを使用)

## 🌳 トピック・ツリー
(過去の話題は圧縮し、現在の話題は詳細に展開)
- **話題1 (完了)**
  - [結論] 〇〇に決定
- **話題2 (現在進行中)**
  - 詳細な議論ポイントA
  - 詳細な議論ポイントB
    - [ToDo] 〇〇さんが調査

## ⏱️ 直近ログ
(直近の発言を、文脈補正した上で時系列で3件程度追記)
"""

    @staticmethod
    def build_user_prompt(current_summary: str, new_text_chunk: str) -> str:
        """
        ユーザープロンプトを構築

        Args:
            current_summary: 現在の議事録（空文字列の場合は初期状態）
            new_text_chunk: 新しい発言テキスト

        Returns:
            str: 構築されたユーザープロンプト
        """
        # 現在の議事録がない場合の初期値
        context = current_summary if current_summary else "(まだ議事録はありません)"

        return f"""
【現在の議事録】
{context}

【新しい発言（音声認識生データ・誤字含む）】
{new_text_chunk}
"""
